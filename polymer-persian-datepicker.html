<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="jquery-import.html">
<link rel="import" href="moment-import.html">

<!-- Import javascript -->
<link rel="import" href="../paper-input/paper-input-container.html">
<script src="../persian-date/dist/0.1.8/persian-date-0.1.8.js"></script>
<script src="../persian-datepicker/dist/js/persian-datepicker-0.4.5.js"></script>


<!-- Import CSS classes -->
<link rel="stylesheet" href="../persian-datepicker/dist/css/persian-datepicker-0.4.5.css"/>
<link rel="stylesheet" href="../persian-datepicker/dist/css/theme/persian-datepicker-cheerup.css"/>
<!--
<link rel="stylesheet" href="../persian-datepicker/dist/css/theme/persian-datepicker-blue.css"/>
<link rel="stylesheet" href="../persian-datepicker/dist/css/theme/persian-datepicker-dark.css"/>
<link rel="stylesheet" href="../persian-datepicker/dist/css/theme/persian-datepicker-redblack.css"/>
-->

<!--
`polymer-persian-datepicker`
a persian datepicker polymer 1 element based on https://github.com/babakhani/pwt.datepicker

@demo demo/index.html
-->

<style>
  .datepicker-plot-area .datepicker-day-view .table-days td {
    height: 26px;

  }

  .datepicker-plot-area {
    width: 270px;
    height: 305px;
  }

  .datepicker-plot-area .datepicker-day-view, .datepicker-plot-area .datepicker-month-view, .datepicker-plot-area .datepicker-year-view {
    min-height: 205px !important;
    margin: 30px 1% 0px 1%;
  }

  .datepicker-plot-area .datepicker-day-view .month-grid-box .header .header-row {
    margin-bottom: 10px;
  }

  .datepicker-plot-area .datepicker-day-view .month-grid-box .header .header-row-cell {
    color: #d6d6d6;
  }

  .datepicker-plot-area .datepicker-header {
    /*background-color: #000000;*/
  }

  .datepicker-plot-area .datepicker-header .btn-next,
  .datepicker-plot-area .datepicker-header .btn-switch,
  .datepicker-plot-area .datepicker-header .btn-prev,
  .datepicker-plot-area .datepicker-header .btn-next:hover,
  .datepicker-plot-area .datepicker-header .btn-switch:hover,
  .datepicker-plot-area .datepicker-header .btn-prev:hover {
    background-color: #6d7c8d;
    color: #d5dae2;
    margin: 10px 1px;
    padding: 10px 0;
    /*border: 1px dotted #cbcbcb;*/
  }
</style>

<dom-module id="polymer-persian-datepicker">
  <template>
    <style>
      :host {
        display: block;
      }

      input.date-picker-input {
        direction: ltr;
        width: 90%;
        text-align: right;
        cursor: pointer !important;
        background: none #fff;
        /*border: 1px solid #c6c6c6;
        border-radius: 3px;*/
        /*
                box-shadow: 0 1px 1px rgba(0, 0, 0, 0.07) inset;
                box-sizing: border-box;
        */
        display: inline-block;
        font-size: 1em;
        /*margin-bottom: 0.5em;*/
        padding: 0.5em;
      }

      .pointer * {
        cursor: pointer !important;
      }

      .datepicker-plot-area {
        right: 0px !important;
      }

      .label {
        @apply(--paper-input-container-label);
      }


    </style>

    [[value]]


    <paper-input-container
      auto-validate$="[[autoValidate]]" disabled$="[[disabled]]" invalid="[[invalid]]">
      <div class="label">[[label]]</div>
      <div class="horizontal layout">
        <input label="[[label]]" type="text" class="date-picker date-picker-input" on-click="showDatePicker"
               readonly="readonly">
        <template is="dom-if" if="[[showIcon]]">
          <iron-icon class="icon pointer" on-click="showDatePicker" icon="icons:perm-contact-calendar"></iron-icon>
        </template>
      </div>
    </paper-input-container>

  </template>

  <script>
    Polymer({

      is: 'polymer-persian-datepicker',

      properties: {
        value: {
          type: String,
          notify: true,
//          value: '2017-12-29T00:13:00.000',
          observer: '_valueChange'
        },
        timePickerEnabled: {
          type: Boolean,
          value: false
        },
        dateFormat: {
          type: String,
          value: 'YYYY-MM-DD'
        },
        showIcon: {
          type: Boolean,
          value: false
        },

        autoClose: {
          type: Boolean,
          value: false
        },

        label: String
      },


      ready: function () {


      },

      initializeDatePicker: function () {
        var me = this;
        this.datePicker = jQuery(this).find('.date-picker').pDatepicker({
          format: me.dateFormat,
          autoClose: me.autoClose,
          persianDigit: true,
          timePicker: {
            enabled: me.timePickerEnabled
          },
          onSelect: function (date, datepicker) {
            me.value = moment(datepicker.state.selected.unixDate).toISOString();
          },
          onHide: function () {
            if (!me.value) {
              jQuery(me).find('.date-picker').val('');
            }
          }
        });
      },

      showDatePicker: function () {
        if (!this.datePicker) {
          this.initializeDatePicker();
        }
        jQuery(this).find('.date-picker').pDatepicker('show');
      },

      _valueChange: function () {
        if (this.value && this.datePicker) {
          var stringDate = moment(this.value).format();
          stringDate = moment(stringDate).unix();
          var selectedDate = persianDate().unix(stringDate);


          jQuery(this).find('.date-picker').pDatepicker('setDate',
            [
              selectedDate.pDate.year,
              selectedDate.pDate.month,
              selectedDate.pDate.monthDayNumber + 1,
              selectedDate.pDate.hours,
              selectedDate.pDate.minutes
            ]
          )
        } else if (this.value) {
          jQuery(this).find('.date-picker').val(this.value);
          this.initializeDatePicker();
        } else if (this.datePicker) {
          jQuery(this).find('.date-picker').val(null);
          jQuery(this).find('.date-picker').pDatepicker('destroy');
          this.datePicker = null;
        }
      }

    });
  </script>
</dom-module>
